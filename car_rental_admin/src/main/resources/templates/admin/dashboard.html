<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Admin Dashboard - Auto Rent Da Nang</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="admin-container">
    <!-- Sidebar -->
    <div th:replace="fragments/sidebar :: admin-sidebar"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <div th:replace="fragments/navbar :: admin-navbar"></div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Tổng số xe</h3>
                        <p class="stat-number" th:text="${totalCars ?: 24}">24</p>
                        <span class="stat-change positive">+2 từ tháng trước</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Đặt xe hôm nay</h3>
                        <p class="stat-number" th:text="${todayBookings ?: 8}">8</p>
                        <span class="stat-change positive">+3 từ hôm qua</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Doanh thu tháng</h3>
                        <p class="stat-number" th:text="${monthlyRevenue ?: '$45,250'}">$45,250</p>
                        <span class="stat-change positive">+12% từ tháng trước</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Khách hàng mới</h3>
                        <p class="stat-number" th:text="${newCustomers ?: 12}">12</p>
                        <span class="stat-change positive">+5 tuần này</span>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Doanh thu 7 ngày</h3>
                        <select class="chart-filter">
                            <option>7 ngày</option>
                            <option>30 ngày</option>
                            <option>3 tháng</option>
                        </select>
                    </div>
                    <div class="chart-canvas-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Xe được thuê nhiều nhất</h3>
                    </div>
                    <div class="chart-canvas-container">
                        <canvas id="popularCarsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="activities-section">
                <div class="section-header">
                    <h3>Hoạt động gần đây</h3>
                    <a class="view-all-btn" href="/admin/bookings" th:href="@{/admin/bookings}">Xem tất cả</a>
                </div>

                <div class="activities-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="activity-content">
                            <p><strong>Nguyễn Văn A</strong> đặt xe Toyota Camry</p>
                            <span class="activity-time">5 phút trước</span>
                        </div>
                        <div class="activity-status pending">Chờ xử lý</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="activity-content">
                            <p><strong>Trần Thị B</strong> hoàn thành thuê xe Honda Civic</p>
                            <span class="activity-time">1 giờ trước</span>
                        </div>
                        <div class="activity-status completed">Hoàn thành</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="activity-content">
                            <p>Xe <strong>BMW X5</strong> được thêm vào hệ thống</p>
                            <span class="activity-time">2 giờ trước</span>
                        </div>
                        <div class="activity-status new">Mới</div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="activity-content">
                            <p>Xe <strong>Mercedes C200</strong> cần bảo dưỡng</p>
                            <span class="activity-time">3 giờ trước</span>
                        </div>
                        <div class="activity-status warning">Cảnh báo</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Thao tác nhanh</h3>
                <div class="actions-grid">
                    <button class="action-btn" th:onclick="|location.href='@{/admin/cars/create}'|">
                        <i class="fas fa-plus"></i>
                        <span>Thêm xe mới</span>
                    </button>
                    <button class="action-btn" th:onclick="|location.href='@{/admin/bookings/create}'|">
                        <i class="fas fa-calendar-plus"></i>
                        <span>Tạo đặt xe</span>
                    </button>
                    <button class="action-btn" th:onclick="|location.href='@{/admin/customers/create}'|">
                        <i class="fas fa-user-plus"></i>
                        <span>Thêm khách hàng</span>
                    </button>
                    <button class="action-btn" onclick="generateReport()">
                        <i class="fas fa-file-download"></i>
                        <span>Xuất báo cáo</span>
                    </button>
                </div>
            </div>
        </div>
    </main>
</div>
<script>
    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
        toast.innerHTML = `
            <div class="toast-content">
                <i class="${icon}"></i>
                <span>${message}</span>
            </div>
        `;
        toastContainer.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('show');
        }, 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toastContainer.removeChild(toast);
            }, 300);
        }, 3000);
    }

    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('login')) {
            showToast('Login Success!', 'success');
            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    });
</script>
<div id="toast-container"></div>
<style>
    /* Toast styling tương tự như login */
    #toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
    }

    .toast {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        padding: 16px 20px;
        min-width: 300px;
        transform: translateX(400px);
        transition: all 0.3s ease-in-out;
        opacity: 0;
        border-left: 4px solid #28a745;
    }

    .toast.toast-success {
        border-left-color: #28a745;
    }

    .toast.toast-error {
        border-left-color: #dc3545;
    }

    .toast.show {
        transform: translateX(0);
        opacity: 1;
    }

    .toast-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .toast-content i {
        font-size: 18px;
        color: #28a745;
    }

    .toast.toast-error .toast-content i {
        color: #dc3545;
    }

    .toast-content span {
        font-size: 14px;
        font-weight: 500;
        color: #333;
    }
</style>
<script th:src="@{/js/dashboard.js}"></script>
<script th:src="@{/js/main.js}"></script>
</body>
</html>