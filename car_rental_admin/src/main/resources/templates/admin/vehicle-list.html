<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vehicle Management - Auto Rent Admin</title>
  <link rel="stylesheet" th:href="@{/css/style.css}" />
  <link rel="stylesheet" th:href="@{/css/table.css}" />
  <link rel="stylesheet" th:href="@{/css/modal.css}" />
  <link rel="stylesheet" th:href="@{/css/vehicles.css}" />
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
          rel="stylesheet"
  />
</head>
<body>
<div class="admin-container">
  <div
          th:replace="fragments/sidebar :: admin-sidebar(activeMenu='vehicles')"
  ></div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <div th:replace="fragments/navbar :: admin-navbar"></div>

    <!-- Vehicles Content -->
    <div class="vehicles-content">
      <!-- Page Header with Actions -->
      <div class="page-header">
        <div class="header-content">
          <div class="header-title">
            <h2>Vehicle Management</h2>
            <p>Manage your rental fleet and vehicle information</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-outline" onclick="exportVehicles()">
              <i class="fas fa-download"></i>
              Export Excel
            </button>
            <button class="btn btn-primary" onclick="openAddVehicleModal()">
              <i class="fas fa-plus"></i>
              Add Vehicle
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-row">
          <div class="stat-card total">
            <div class="stat-icon total">
              <i class="fas fa-car"></i>
            </div>
            <div class="stat-content">
              <h3>Total Vehicles</h3>
              <p class="stat-number" th:text="${totalVehicles}">0</p>
              <span class="stat-change positive">+1 this month</span>
            </div>
          </div>
          <div class="stat-card available">
            <div class="stat-icon available">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3>Available</h3>
              <p class="stat-number" th:text="${availableVehicles}">0</p>
              <span
                      class="stat-change positive"
                      th:text="${totalVehicles > 0 ? (availableVehicles * 100 / totalVehicles) + '% availability' : '0% availability'}"
              >
                    0% availability
                  </span>
            </div>
          </div>
          <div class="stat-card rented">
            <div class="stat-icon rented">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
              <h3>Currently Rented</h3>
              <p class="stat-number" th:text="${rentedVehicles}">0</p>
              <span class="stat-change">Active rentals</span>
            </div>
          </div>
          <div class="stat-card maintenance">
            <div class="stat-icon maintenance">
              <i class="fas fa-tools"></i>
            </div>
            <div class="stat-content">
              <h3>In Maintenance</h3>
              <p class="stat-number" th:text="${maintenanceVehicles}">0</p>
              <span class="stat-change">Service required</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Table Controls -->
      <div class="table-controls">
        <form method="get" th:action="@{/admin/vehicles}">
          <div class="table-filters">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input
                      type="text"
                      name="search"
                      th:value="${search}"
                      placeholder="Search by name, license plate, brand..."
              />
            </div>
            <div class="filter-group">
              <select name="brand" th:value="${brand}">
                <option value="">All Brands</option>
                <option value="Toyota">Toyota</option>
                <option value="Honda">Honda</option>
                <option value="Mazda">Mazda</option>
                <option value="Hyundai">Hyundai</option>
                <option value="BMW">BMW</option>
                <option value="Mercedes">Mercedes</option>
              </select>
              <select name="status" th:value="${status}">
                <option value="">All Status</option>
                <option value="Available">Available</option>
                <option value="Rented">Rented</option>
                <option value="Maintenance">Maintenance</option>
                <option value="Unavailable">Unavailable</option>
              </select>
              <button type="submit" class="btn btn-outline btn-sm">
                <i class="fas fa-filter"></i> Filter
              </button>
            </div>
          </div>
        </form>
        <div class="table-actions">
          <button
                  class="btn btn-outline btn-sm"
                  onclick="window.location.reload()"
          >
            <i class="fas fa-sync-alt"></i>
            Refresh
          </button>
        </div>
      </div>

      <!-- Main Table -->
      <div class="table-container">
        <table class="data-table" id="vehicles-table">
          <thead>
          <tr>
            <th class="sortable" data-sort="image">
              <span>Image</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="sortable" data-sort="vehicle">
              <span>Vehicle Information</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="sortable" data-sort="license">
              <span>License Plate</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="sortable" data-sort="price">
              <span>Daily Rate</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="sortable" data-sort="status">
              <span>Status</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="sortable" data-sort="last-rental">
              <span>Owner</span>
              <i class="fas fa-sort"></i>
            </th>
            <th class="no-sort">Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="vehicle : ${vehicles}">
            <td>
              <div class="vehicle-image">
                <img
                        th:src="${vehicle.imageList != null && !vehicle.imageList.isEmpty() ? vehicle.imageList.get(0) : 'https://via.placeholder.com/300x200/f3f4f6/6b7280?text=No+Image'}"
                        th:alt="${vehicle.vehicleName}"
                />
              </div>
            </td>
            <td>
              <div class="vehicle-info">
                <div class="vehicle-details">
                        <span
                                class="vehicle-name"
                                th:text="${vehicle.vehicleName}"
                        >Car Name</span
                        >
                  <span
                          class="vehicle-specs"
                          th:text="${vehicle.vehicleSeat + ' seats • ' + vehicle.transmission + ' • ' + vehicle.fuelType}"
                  >Specs</span
                  >
                </div>
              </div>
            </td>
            <td>
                    <span
                            class="license-plate"
                            th:text="${vehicle.licensePlate}"
                    >43A-12345</span
                    >
            </td>
            <td>
                    <span class="price" th:text="'$' + ${vehicle.dailyPrice}"
                    >Price</span
                    >
              <span class="price-period">/day</span>
            </td>
            <td>
                    <span
                            th:class="'status-badge ' + ${vehicle.status != null ? vehicle.status.toLowerCase() : ''}"
                            th:text="${vehicle.status}"
                    ></span>
            </td>
            <td>
                    <span
                            th:text="${vehicle.user != null ? vehicle.user.name : 'N/A'}"
                    >Owner</span
                    >
            </td>
            <td>
              <div class="action-buttons">
                <a
                        th:href="@{'/admin/vehicles/' + ${vehicle.id}}"
                        class="btn-action btn-view"
                        title="View Details"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <button
                        class="btn-action btn-edit"
                        onclick="editVehicle([[${vehicle.id}]])"
                        title="Edit Vehicle"
                >
                  <i class="fas fa-edit"></i>
                </button>
                <button
                        class="btn-action btn-delete"
                        onclick="deleteVehicle([[${vehicle.id}]])"
                        title="Delete Vehicle"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Table Footer -->
      <div class="table-footer">
        <div class="table-info">
          <div class="entries-info">
            <span class="showing-text">Showing</span>
            <span
                    class="entries-count"
                    th:text="${(currentPage - 1) * 6 + 1}"
            >1</span
            >
            <span>to</span>
            <span
                    class="entries-count"
                    th:text="${currentPage * 6 > totalElements ? totalElements : currentPage * 6}"
            >6</span
            >
            <span>of</span>
            <span class="total-entries" th:text="${totalElements}">6</span>
            <span>entries</span>
          </div>
        </div>

        <div class="pagination-wrapper">
          <nav class="pagination-nav" aria-label="Pagination Navigation">
            <!-- First Page Button -->
            <a
                    th:if="${currentPage > 1}"
                    th:href="@{/admin/vehicles(page=0,size=6,search=${search},brand=${brand},status=${status})}"
                    class="pagination-btn first-page"
                    title="First Page"
            >
              <i class="fas fa-angle-double-left"></i>
            </a>

            <!-- Previous Button -->
            <a
                    th:if="${currentPage > 1}"
                    th:href="@{/admin/vehicles(page=${currentPage - 2},size=6,search=${search},brand=${brand},status=${status})}"
                    class="pagination-btn prev-page"
                    title="Previous Page"
            >
              <i class="fas fa-chevron-left"></i>
              <span class="btn-text">Previous</span>
            </a>

            <!-- Page Numbers -->
            <div class="page-numbers">
              <!-- Show ellipsis if there are many pages before current -->
              <span th:if="${currentPage > 3}">
                    <a
                            th:href="@{/admin/vehicles(page=0,size=6,search=${search},brand=${brand},status=${status})}"
                            class="page-btn"
                    >1</a
                    >
                    <span class="page-ellipsis" th:if="${currentPage > 4}"
                    >...</span
                    >
                  </span>

              <!-- Show pages around current page -->
              <span
                      th:each="i : ${#numbers.sequence(
                    currentPage > 2 ? currentPage - 1 : 1,
                    currentPage < totalPages - 1 ? currentPage + 1 : totalPages
                  )}"
              >
                    <a
                            th:href="@{/admin/vehicles(page=${i - 1},size=6,search=${search},brand=${brand},status=${status})}"
                            th:class="'page-btn' + (i == currentPage ? ' active' : '')"
                            th:text="${i}"
                            th:title="'Go to page ' + ${i}"
                    ></a>
                  </span>

              <!-- Show ellipsis if there are many pages after current -->
              <span th:if="${currentPage < totalPages - 2}">
                    <span
                            class="page-ellipsis"
                            th:if="${currentPage < totalPages - 3}"
                    >...</span
                    >
                    <a
                            th:href="@{/admin/vehicles(page=${totalPages - 1},size=6,search=${search},brand=${brand},status=${status})}"
                            class="page-btn"
                            th:text="${totalPages}"
                    ></a>
                  </span>
            </div>

            <!-- Next Button -->
            <a
                    th:if="${currentPage < totalPages}"
                    th:href="@{/admin/vehicles(page=${currentPage},size=6,search=${search},brand=${brand},status=${status})}"
                    class="pagination-btn next-page"
                    title="Next Page"
            >
              <span class="btn-text">Next</span>
              <i class="fas fa-chevron-right"></i>
            </a>

            <!-- Last Page Button -->
            <a
                    th:if="${currentPage < totalPages}"
                    th:href="@{/admin/vehicles(page=${totalPages - 1},size=6,search=${search},brand=${brand},status=${status})}"
                    class="pagination-btn last-page"
                    title="Last Page"
            >
              <i class="fas fa-angle-double-right"></i>
            </a>
          </nav>

          <!-- Page Jump -->
          <div class="page-jump" th:if="${totalPages > 5}">
            <label>Go to page:</label>
            <input
                    type="number"
                    id="page-jump-input"
                    min="1"
                    th:max="${totalPages}"
                    th:placeholder="'1-' + ${totalPages}"
                    onkeypress="jumpToPage(event)"
            />
            <button onclick="jumpToPage()" class="jump-btn">
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Vehicle Details Modal -->
<div id="vehicle-details-modal" class="modal">
  <div class="modal-content large">
    <div class="modal-header">
      <h3>Vehicle Details</h3>
      <button
              class="modal-close"
              onclick="closeModal('vehicle-details-modal')"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div id="vehicle-details-content">
        <!-- Vehicle details will be loaded here -->
      </div>
    </div>
    <div class="modal-footer">
      <button
              type="button"
              class="btn btn-outline"
              onclick="closeModal('vehicle-details-modal')"
      >
        Close
      </button>
      <button
              type="button"
              class="btn btn-primary"
              onclick="editVehicleFromDetails()"
      >
        <i class="fas fa-edit"></i>
        Edit Vehicle
      </button>
    </div>
  </div>
</div>

<script th:src="@{/js/main.js}"></script>
<script th:src="@{/js/vehicles.js}"></script>
<!-- Import thư viện SockJS và StompJS trước -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<!-- Import file JS WebSocket riêng -->
<script th:src="@{/js/websocket-notify.js}"></script>
</body>
</html>
